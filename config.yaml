# PTZ Camera Object Tracking System - Configuration File

# Video Input/Output
video:
  input_path: "input.mp4"
  output_path: "output.mp4"
  output_codec: "mp4v"  # Options: mp4v, X264, MJPG
  save_output: true
  loop_playback: false
  process_every_n_frames: 1  # Process every frame (1 = all frames)

# Background Subtraction
background_subtraction:
  library: "opencv"  # Options: opencv, bgslibrary
  algorithm: "MOG2"  # OpenCV: MOG2, KNN, MOG, GMG, CNT | BGSLibrary: FrameDifference, ViBe, SuBSENSE, PAWCS, etc.

  # OpenCV-specific parameters
  history: 500
  var_threshold: 16.0  # For MOG2
  dist2_threshold: 400.0  # For KNN
  detect_shadows: true
  learning_rate: -1  # -1 for automatic, or 0.001-0.1

# Foreground Mask Post-Processing
# Pipeline: Erosion -> Dilation -> Gaussian Blur -> Closing -> Threshold
mask_processing:
  enable: true
  kernel_size: 5  # Morphological kernel size: 3, 5, 7, 9 (default: 5)
  erosion_iterations: 1
  dilation_iterations: 1
  gaussian_blur_kernel: 3  # Must be odd: 3, 5, 7 (default: 3)
  threshold_value: 130  # Binary threshold: 100-150 (default: 130)

# Object Detection
object_detection:
  min_area: 500  # Minimum contour area in pixels
  max_area_fraction: 0.3  # Maximum area as fraction of frame (0.0-1.0)
  min_aspect_ratio: 0.2
  max_aspect_ratio: 5.0
  min_solidity: 0.3
  min_extent: 0.2
  selection_strategy: "largest"  # Options: largest, center, previous

# Tracking - Dual Mode System
tracking:
  # Tracking Mode: "detection" (Norfair multi-object) or "locked" (CSRT single-object)
  initial_mode: "detection"  # Start in detection mode

  # Norfair Multi-Object Tracking (Detection Mode)
  norfair:
    distance_threshold: 50  # Maximum pixels for object association
    hit_counter_max: 10  # Frames to keep track without detection
    initialization_delay: 3  # Frames before confirming new track
    pointwise_hit_counter_max: 4

  # CSRT Single-Object Tracking (Locked Mode)
  csrt:
    enable: true  # Enable CSRT tracker
    lost_frames_threshold: 15  # Frames before declaring CSRT lost
    recovery_timeout: 3.0  # Seconds to attempt recovery
    min_bbox_area: 100  # Minimum bbox area (pixels)
    max_bbox_area_fraction: 0.8  # Maximum bbox area (fraction of frame)

  # Object Selection
  selection:
    method: "largest"  # Options: largest, center, manual, auto
    auto_select_threshold: 30  # Frames before auto-selecting (if auto enabled)
    min_track_age: 5  # Minimum frames tracked before selectable

  # Mode Transition
  transition:
    enable_auto_lock: false  # Automatically lock onto largest object
    enable_manual_selection: true  # Allow mouse click selection
    recovery_search_radius: 150  # Pixels to search for lost object
    size_similarity_threshold: 0.5  # 0.0-1.0 for object matching

  # PTZ Deadband
  deadband_x: 0.05  # Horizontal deadband (fraction of frame width)
  deadband_y: 0.05  # Vertical deadband (fraction of frame height)

# PTZ Control
ptz_control:
  pan_sensitivity: 45.0  # Degrees per normalized unit
  tilt_sensitivity: 30.0  # Degrees per normalized unit
  max_pan_speed: 2.0  # Degrees per frame
  max_tilt_speed: 1.5  # Degrees per frame
  min_zoom: 1.0
  max_zoom: 5.0
  zoom_speed: 0.05  # Zoom change per frame
  smoothing_factor: 0.3  # 0.0-1.0, higher = more smoothing
  target_object_size: 0.3  # Target object size as fraction of frame

# Display
display:
  show_window: true
  window_name: "PTZ Tracking"
  window_mode: "normal"  # Options: normal, fullscreen
  show_bounding_box: true
  show_info_overlay: true
  show_trajectory: false
  show_debug_mosaic: true  # Show 2x4 grid of pipeline stages for debugging
  save_debug_mosaic: false  # Save mosaic to video file
  output_width: null  # null = same as input
  output_height: null  # null = same as input

# Rendering
rendering:
  interpolation: "linear"  # Options: nearest, linear, cubic, lanczos4, area
  font_scale: 0.6
  font_thickness: 2
  line_thickness: 2

# Logging
logging:
  level: "INFO"  # Options: DEBUG, INFO, WARNING, ERROR
  log_to_file: true
  log_file: "logs/tracking.log"
  save_telemetry: true
  telemetry_file: "logs/telemetry.csv"
